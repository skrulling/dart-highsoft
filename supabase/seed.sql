-- Local development seed data
-- Populates realistic-looking players and historical x01 matches so UI screens
-- (games list, leaderboards, stats) are useful immediately after `supabase db reset`.

-- 8 local players
insert into public.players (id, display_name, elo_rating, elo_rating_multi, created_at)
values
  ('70000000-0000-0000-0000-000000000001', 'Alex Storm', 1320, 1288, now() - interval '120 days'),
  ('70000000-0000-0000-0000-000000000002', 'Mia Larsen', 1385, 1362, now() - interval '112 days'),
  ('70000000-0000-0000-0000-000000000003', 'Jonas Pike', 1258, 1271, now() - interval '104 days'),
  ('70000000-0000-0000-0000-000000000004', 'Nora Vale', 1422, 1401, now() - interval '96 days'),
  ('70000000-0000-0000-0000-000000000005', 'Viktor Rune', 1294, 1313, now() - interval '88 days'),
  ('70000000-0000-0000-0000-000000000006', 'Freya Hale', 1347, 1336, now() - interval '80 days'),
  ('70000000-0000-0000-0000-000000000007', 'Liam Frost', 1216, 1230, now() - interval '72 days'),
  ('70000000-0000-0000-0000-000000000008', 'Zoe Mercer', 1368, 1351, now() - interval '64 days')
on conflict (id) do update
set
  display_name = excluded.display_name,
  elo_rating = excluded.elo_rating,
  elo_rating_multi = excluded.elo_rating_multi;

-- Historical + active matches
insert into public.matches (
  id, mode, start_score, finish, legs_to_win,
  winner_player_id, completed_at, ended_early, created_at
)
values
  ('91000000-0000-0000-0000-000000000001', 'x01', '501', 'double_out', 2, '70000000-0000-0000-0000-000000000001', now() - interval '42 days', false, now() - interval '42 days 3 hours'),
  ('91000000-0000-0000-0000-000000000002', 'x01', '301', 'single_out', 3, '70000000-0000-0000-0000-000000000004', now() - interval '34 days', false, now() - interval '34 days 2 hours'),
  ('91000000-0000-0000-0000-000000000003', 'x01', '501', 'double_out', 2, '70000000-0000-0000-0000-000000000006', now() - interval '26 days', false, now() - interval '26 days 1 hours'),
  ('91000000-0000-0000-0000-000000000004', 'x01', '301', 'double_out', 2, '70000000-0000-0000-0000-000000000007', now() - interval '19 days', false, now() - interval '19 days 4 hours'),
  ('91000000-0000-0000-0000-000000000005', 'x01', '501', 'double_out', 1, '70000000-0000-0000-0000-000000000003', now() - interval '12 days', false, now() - interval '12 days 30 minutes'),
  ('91000000-0000-0000-0000-000000000006', 'x01', '301', 'single_out', 1, '70000000-0000-0000-0000-000000000002', now() - interval '8 days', true,  now() - interval '8 days 2 hours'),
  ('91000000-0000-0000-0000-000000000007', 'x01', '301', 'double_out', 2, null, null, false, now() - interval '35 minutes')
on conflict (id) do nothing;

insert into public.match_players (match_id, player_id, play_order)
values
  ('91000000-0000-0000-0000-000000000001', '70000000-0000-0000-0000-000000000001', 0),
  ('91000000-0000-0000-0000-000000000001', '70000000-0000-0000-0000-000000000002', 1),

  ('91000000-0000-0000-0000-000000000002', '70000000-0000-0000-0000-000000000003', 0),
  ('91000000-0000-0000-0000-000000000002', '70000000-0000-0000-0000-000000000004', 1),

  ('91000000-0000-0000-0000-000000000003', '70000000-0000-0000-0000-000000000005', 0),
  ('91000000-0000-0000-0000-000000000003', '70000000-0000-0000-0000-000000000006', 1),

  ('91000000-0000-0000-0000-000000000004', '70000000-0000-0000-0000-000000000007', 0),
  ('91000000-0000-0000-0000-000000000004', '70000000-0000-0000-0000-000000000008', 1),

  ('91000000-0000-0000-0000-000000000005', '70000000-0000-0000-0000-000000000001', 0),
  ('91000000-0000-0000-0000-000000000005', '70000000-0000-0000-0000-000000000003', 1),

  ('91000000-0000-0000-0000-000000000006', '70000000-0000-0000-0000-000000000002', 0),
  ('91000000-0000-0000-0000-000000000006', '70000000-0000-0000-0000-000000000005', 1),

  ('91000000-0000-0000-0000-000000000007', '70000000-0000-0000-0000-000000000004', 0),
  ('91000000-0000-0000-0000-000000000007', '70000000-0000-0000-0000-000000000006', 1)
on conflict (match_id, player_id) do nothing;

insert into public.legs (id, match_id, leg_number, starting_player_id, winner_player_id, created_at)
values
  ('92000000-0000-0000-0000-000000000011', '91000000-0000-0000-0000-000000000001', 1, '70000000-0000-0000-0000-000000000001', '70000000-0000-0000-0000-000000000001', now() - interval '42 days 2 hours'),
  ('92000000-0000-0000-0000-000000000012', '91000000-0000-0000-0000-000000000001', 2, '70000000-0000-0000-0000-000000000002', '70000000-0000-0000-0000-000000000002', now() - interval '42 days 90 minutes'),
  ('92000000-0000-0000-0000-000000000013', '91000000-0000-0000-0000-000000000001', 3, '70000000-0000-0000-0000-000000000001', '70000000-0000-0000-0000-000000000001', now() - interval '42 days 1 hour'),

  ('92000000-0000-0000-0000-000000000021', '91000000-0000-0000-0000-000000000002', 1, '70000000-0000-0000-0000-000000000003', '70000000-0000-0000-0000-000000000004', now() - interval '34 days 2 hours'),
  ('92000000-0000-0000-0000-000000000022', '91000000-0000-0000-0000-000000000002', 2, '70000000-0000-0000-0000-000000000004', '70000000-0000-0000-0000-000000000003', now() - interval '34 days 80 minutes'),
  ('92000000-0000-0000-0000-000000000023', '91000000-0000-0000-0000-000000000002', 3, '70000000-0000-0000-0000-000000000003', '70000000-0000-0000-0000-000000000004', now() - interval '34 days 45 minutes'),
  ('92000000-0000-0000-0000-000000000024', '91000000-0000-0000-0000-000000000002', 4, '70000000-0000-0000-0000-000000000004', '70000000-0000-0000-0000-000000000004', now() - interval '34 days 20 minutes'),

  ('92000000-0000-0000-0000-000000000031', '91000000-0000-0000-0000-000000000003', 1, '70000000-0000-0000-0000-000000000005', '70000000-0000-0000-0000-000000000006', now() - interval '26 days 55 minutes'),
  ('92000000-0000-0000-0000-000000000032', '91000000-0000-0000-0000-000000000003', 2, '70000000-0000-0000-0000-000000000006', '70000000-0000-0000-0000-000000000005', now() - interval '26 days 30 minutes'),
  ('92000000-0000-0000-0000-000000000033', '91000000-0000-0000-0000-000000000003', 3, '70000000-0000-0000-0000-000000000005', '70000000-0000-0000-0000-000000000006', now() - interval '26 days 10 minutes'),

  ('92000000-0000-0000-0000-000000000041', '91000000-0000-0000-0000-000000000004', 1, '70000000-0000-0000-0000-000000000007', '70000000-0000-0000-0000-000000000007', now() - interval '19 days 3 hours'),
  ('92000000-0000-0000-0000-000000000042', '91000000-0000-0000-0000-000000000004', 2, '70000000-0000-0000-0000-000000000008', '70000000-0000-0000-0000-000000000008', now() - interval '19 days 2 hours'),
  ('92000000-0000-0000-0000-000000000043', '91000000-0000-0000-0000-000000000004', 3, '70000000-0000-0000-0000-000000000007', '70000000-0000-0000-0000-000000000007', now() - interval '19 days 80 minutes'),

  ('92000000-0000-0000-0000-000000000051', '91000000-0000-0000-0000-000000000005', 1, '70000000-0000-0000-0000-000000000001', '70000000-0000-0000-0000-000000000003', now() - interval '12 days 25 minutes'),

  ('92000000-0000-0000-0000-000000000061', '91000000-0000-0000-0000-000000000006', 1, '70000000-0000-0000-0000-000000000002', '70000000-0000-0000-0000-000000000002', now() - interval '8 days 70 minutes'),

  ('92000000-0000-0000-0000-000000000071', '91000000-0000-0000-0000-000000000007', 1, '70000000-0000-0000-0000-000000000004', null, now() - interval '35 minutes')
on conflict (id) do nothing;

do $$
declare
  cfg record;
  i int;
  v_player uuid;
  v_turn_id uuid;
  v_seg1 text;
  v_seg2 text;
  v_seg3 text;
  v_score1 int;
  v_score2 int;
  v_score3 int;
  v_total int;
  v_is_incomplete boolean;
begin
  for cfg in
    select *
    from (
      values
        -- match_id, leg_id, starter_id, other_id, winner_id, turns_count, incomplete_last
        ('91000000-0000-0000-0000-000000000001'::uuid, '92000000-0000-0000-0000-000000000011'::uuid, '70000000-0000-0000-0000-000000000001'::uuid, '70000000-0000-0000-0000-000000000002'::uuid, '70000000-0000-0000-0000-000000000001'::uuid, 8, false),
        ('91000000-0000-0000-0000-000000000001'::uuid, '92000000-0000-0000-0000-000000000012'::uuid, '70000000-0000-0000-0000-000000000002'::uuid, '70000000-0000-0000-0000-000000000001'::uuid, '70000000-0000-0000-0000-000000000002'::uuid, 9, false),
        ('91000000-0000-0000-0000-000000000001'::uuid, '92000000-0000-0000-0000-000000000013'::uuid, '70000000-0000-0000-0000-000000000001'::uuid, '70000000-0000-0000-0000-000000000002'::uuid, '70000000-0000-0000-0000-000000000001'::uuid, 7, false),

        ('91000000-0000-0000-0000-000000000002'::uuid, '92000000-0000-0000-0000-000000000021'::uuid, '70000000-0000-0000-0000-000000000003'::uuid, '70000000-0000-0000-0000-000000000004'::uuid, '70000000-0000-0000-0000-000000000004'::uuid, 7, false),
        ('91000000-0000-0000-0000-000000000002'::uuid, '92000000-0000-0000-0000-000000000022'::uuid, '70000000-0000-0000-0000-000000000004'::uuid, '70000000-0000-0000-0000-000000000003'::uuid, '70000000-0000-0000-0000-000000000003'::uuid, 8, false),
        ('91000000-0000-0000-0000-000000000002'::uuid, '92000000-0000-0000-0000-000000000023'::uuid, '70000000-0000-0000-0000-000000000003'::uuid, '70000000-0000-0000-0000-000000000004'::uuid, '70000000-0000-0000-0000-000000000004'::uuid, 8, false),
        ('91000000-0000-0000-0000-000000000002'::uuid, '92000000-0000-0000-0000-000000000024'::uuid, '70000000-0000-0000-0000-000000000004'::uuid, '70000000-0000-0000-0000-000000000003'::uuid, '70000000-0000-0000-0000-000000000004'::uuid, 7, false),

        ('91000000-0000-0000-0000-000000000003'::uuid, '92000000-0000-0000-0000-000000000031'::uuid, '70000000-0000-0000-0000-000000000005'::uuid, '70000000-0000-0000-0000-000000000006'::uuid, '70000000-0000-0000-0000-000000000006'::uuid, 8, false),
        ('91000000-0000-0000-0000-000000000003'::uuid, '92000000-0000-0000-0000-000000000032'::uuid, '70000000-0000-0000-0000-000000000006'::uuid, '70000000-0000-0000-0000-000000000005'::uuid, '70000000-0000-0000-0000-000000000005'::uuid, 7, false),
        ('91000000-0000-0000-0000-000000000003'::uuid, '92000000-0000-0000-0000-000000000033'::uuid, '70000000-0000-0000-0000-000000000005'::uuid, '70000000-0000-0000-0000-000000000006'::uuid, '70000000-0000-0000-0000-000000000006'::uuid, 9, false),

        ('91000000-0000-0000-0000-000000000004'::uuid, '92000000-0000-0000-0000-000000000041'::uuid, '70000000-0000-0000-0000-000000000007'::uuid, '70000000-0000-0000-0000-000000000008'::uuid, '70000000-0000-0000-0000-000000000007'::uuid, 7, false),
        ('91000000-0000-0000-0000-000000000004'::uuid, '92000000-0000-0000-0000-000000000042'::uuid, '70000000-0000-0000-0000-000000000008'::uuid, '70000000-0000-0000-0000-000000000007'::uuid, '70000000-0000-0000-0000-000000000008'::uuid, 8, false),
        ('91000000-0000-0000-0000-000000000004'::uuid, '92000000-0000-0000-0000-000000000043'::uuid, '70000000-0000-0000-0000-000000000007'::uuid, '70000000-0000-0000-0000-000000000008'::uuid, '70000000-0000-0000-0000-000000000007'::uuid, 7, false),

        ('91000000-0000-0000-0000-000000000005'::uuid, '92000000-0000-0000-0000-000000000051'::uuid, '70000000-0000-0000-0000-000000000001'::uuid, '70000000-0000-0000-0000-000000000003'::uuid, '70000000-0000-0000-0000-000000000003'::uuid, 7, false),
        ('91000000-0000-0000-0000-000000000006'::uuid, '92000000-0000-0000-0000-000000000061'::uuid, '70000000-0000-0000-0000-000000000002'::uuid, '70000000-0000-0000-0000-000000000005'::uuid, '70000000-0000-0000-0000-000000000002'::uuid, 6, false),

        ('91000000-0000-0000-0000-000000000007'::uuid, '92000000-0000-0000-0000-000000000071'::uuid, '70000000-0000-0000-0000-000000000004'::uuid, '70000000-0000-0000-0000-000000000006'::uuid, null::uuid, 5, true)
    ) as t(match_id, leg_id, starter_id, other_id, winner_id, turns_count, incomplete_last)
  loop
    for i in 1..cfg.turns_count loop
      v_is_incomplete := cfg.incomplete_last and i = cfg.turns_count;

      if v_is_incomplete then
        v_player := case when mod(i, 2) = 1 then cfg.starter_id else cfg.other_id end;
        v_seg1 := 'S20'; v_score1 := 20;
        v_seg2 := 'S5'; v_score2 := 5;
        v_seg3 := 'S1'; v_score3 := 1;
        v_total := v_score1;
      else
        if cfg.winner_id is not null and i = cfg.turns_count then
          v_player := cfg.winner_id;
        else
          v_player := case when mod(i, 2) = 1 then cfg.starter_id else cfg.other_id end;
        end if;

        case ((i - 1) % 6) + 1
          when 1 then
            v_seg1 := 'S20'; v_score1 := 20;
            v_seg2 := 'S20'; v_score2 := 20;
            v_seg3 := 'S20'; v_score3 := 20;
          when 2 then
            v_seg1 := 'T20'; v_score1 := 60;
            v_seg2 := 'S19'; v_score2 := 19;
            v_seg3 := 'S2'; v_score3 := 2;
          when 3 then
            v_seg1 := 'S5'; v_score1 := 5;
            v_seg2 := 'S20'; v_score2 := 20;
            v_seg3 := 'S1'; v_score3 := 1;
          when 4 then
            v_seg1 := 'T19'; v_score1 := 57;
            v_seg2 := 'S20'; v_score2 := 20;
            v_seg3 := 'S7'; v_score3 := 7;
          when 5 then
            v_seg1 := 'S1'; v_score1 := 1;
            v_seg2 := 'T20'; v_score2 := 60;
            v_seg3 := 'S1'; v_score3 := 1;
          else
            v_seg1 := 'S20'; v_score1 := 20;
            v_seg2 := 'S5'; v_score2 := 5;
            v_seg3 := 'S5'; v_score3 := 5;
        end case;

        v_total := v_score1 + v_score2 + v_score3;
      end if;

      insert into public.turns (leg_id, player_id, turn_number, total_scored, busted, match_id)
      values (cfg.leg_id, v_player, i, v_total, false, cfg.match_id)
      on conflict (leg_id, turn_number) do update
      set
        player_id = excluded.player_id,
        total_scored = excluded.total_scored,
        busted = excluded.busted,
        match_id = excluded.match_id
      returning id into v_turn_id;

      delete from public.throws where turn_id = v_turn_id;

      insert into public.throws (turn_id, dart_index, segment, scored, match_id)
      values (v_turn_id, 1, v_seg1, v_score1, cfg.match_id);

      if not v_is_incomplete then
        insert into public.throws (turn_id, dart_index, segment, scored, match_id)
        values
          (v_turn_id, 2, v_seg2, v_score2, cfg.match_id),
          (v_turn_id, 3, v_seg3, v_score3, cfg.match_id);
      end if;
    end loop;
  end loop;
end;
$$;
